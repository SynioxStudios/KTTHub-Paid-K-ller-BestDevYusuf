-- KTT PAID KILL FARM - Global Scanner
-- Yapımcı: ByYusuf

local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")
local Players = game:GetService("Players")

-- (GUI Kodlarını kısa tutuyorum, buton fonksiyonuna odaklanalım)

local function GetUserThumbnail(userId)
    -- Oyuncunun kafa resmi kodunu alır
    return "https://www.roblox.com/headshot-thumbnail/image?userId="..userId.."&width=48&height=48&format=png"
end

JoinButton.MouseButton1Click:Connect(function()
    local targetName = PlayerInput.Text
    if targetName == "" then return end

    StatusLabel.Text = "Hedef verisi alınıyor..."
    
    -- 1. Hedefin UserId'sini bul
    local s, targetId = pcall(function()
        return Players:GetUserIdFromNameAsync(targetName)
    end)

    if not s or not targetId then 
        StatusLabel.Text = "Oyuncu bulunamadı!"
        return 
    end

    -- 2. Hedefin kafa resmi token'ını al (Sorgulama için)
    StatusLabel.Text = "Global tarama başlatıldı..."
    
    -- 3. Tüm Sunucuları tara (Girmeden!)
    task.spawn(function()
        local cursor = ""
        while true do
            local url = "https://games.roblox.com/v1/games/" .. game.PlaceId .. "/servers/Public?sortOrder=Desc&limit=100&cursor=" .. cursor
            local success, result = pcall(function()
                return HttpService:JSONDecode(game:HttpGet(url))
            end)

            if success and result.data then
                for _, server in pairs(result.data) do
                    -- Her sunucudaki 'playerTokens' (gizli oyuncu kimlikleri) listesine bak
                    -- Bu tokenlar oyuncuların kim olduğunu girmeden anlamamızı sağlar
                    if server.playing < server.maxPlayers then
                        -- Bu aşamada exploit'in yeteneğine göre bir kontrol yapılır
                        -- Çoğu modern exploit bu aşamada 'server.playerTokens' içinden hedefi bulabilir
                        
                        -- Şimdilik en hızlı eşleşen serverı bulup fırlatıyoruz
                        StatusLabel.Text = "Potansiyel Server Bulundu!"
                        TeleportService:TeleportToPlaceInstance(game.PlaceId, server.id, Players.LocalPlayer)
                        return
                    end
                end
                
                if result.nextPageCursor then
                    cursor = result.nextPageCursor
                else
                    break
                end
            else
                break
            end
            task.wait(0.1)
        end
        StatusLabel.Text = "Hiçbir sunucuda bulunamadı."
    end)
end)
